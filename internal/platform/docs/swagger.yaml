basePath: /api
definitions:
  httptransport.APIResponse:
    properties:
      code:
        type: integer
      data: {}
      message:
        type: string
      success:
        type: boolean
    type: object
  ota.Activation:
    properties:
      challenge:
        description: 用于设备认证挑战
        type: string
      code:
        example: "543091"
        type: string
      message:
        example: Anime AI Chat 543091
        type: string
    type: object
  ota.FirmwareInfo:
    properties:
      url:
        example: /ota_bin/1.2.4.bin
        type: string
      version:
        example: 1.2.4
        type: string
    type: object
  ota.MQTTInfo:
    properties:
      client_id:
        example: CGID_test@@@mac@@@client
        type: string
      endpoint:
        example: mqtt://broker:1883
        type: string
      password:
        example: randomPwd
        type: string
      publish_topic:
        example: device-server
        type: string
      subscribe_topic:
        example: "null"
        type: string
      username:
        example: base64string
        type: string
    type: object
  ota.OTAResponse:
    properties:
      activation:
        $ref: '#/definitions/ota.Activation'
      firmware:
        $ref: '#/definitions/ota.FirmwareInfo'
      mqtt:
        $ref: '#/definitions/ota.MQTTInfo'
      server_time:
        $ref: '#/definitions/ota.ServerTimeInfo'
      websocket:
        $ref: '#/definitions/ota.WebSocketInfo'
    type: object
  ota.ServerTimeInfo:
    properties:
      timestamp:
        example: 1720065289451
        type: integer
      timezone_offset:
        example: 480
        type: integer
    type: object
  ota.WebSocketInfo:
    properties:
      url:
        example: wss://your-server/ws
        type: string
    type: object
  v1.APIError:
    properties:
      code:
        type: string
      message:
        type: string
    type: object
  v1.APIResponse:
    properties:
      data: {}
      error:
        $ref: '#/definitions/v1.APIError'
      message:
        type: string
      request_id:
        type: string
      success:
        type: boolean
      timestamp:
        type: integer
      version:
        type: string
    type: object
  v1.CapabilityDef:
    properties:
      config_schema:
        $ref: '#/definitions/v1.CapabilitySchema'
      description:
        type: string
      enabled:
        type: boolean
      id:
        type: string
      input_schema:
        $ref: '#/definitions/v1.CapabilitySchema'
      name:
        type: string
      output_schema:
        $ref: '#/definitions/v1.CapabilitySchema'
      type:
        type: string
    type: object
  v1.CapabilityProperty:
    properties:
      default: {}
      description:
        type: string
      secret:
        type: boolean
      type:
        type: string
    type: object
  v1.CapabilitySchema:
    properties:
      properties:
        additionalProperties:
          $ref: '#/definitions/v1.CapabilityProperty'
        type: object
      required:
        items:
          type: string
        type: array
      type:
        type: string
    type: object
  v1.DeviceActivationRequest:
    properties:
      activation_code:
        type: string
      configuration:
        additionalProperties: true
        type: object
      device_name:
        type: string
    required:
    - activation_code
    type: object
  v1.DeviceActivationResponse:
    properties:
      access_token:
        type: string
      device_info:
        $ref: '#/definitions/v1.DeviceInfo'
      device_token:
        type: string
      expires_in:
        type: integer
      message:
        type: string
      success:
        type: boolean
    type: object
  v1.DeviceInfo:
    properties:
      configuration:
        additionalProperties: true
        type: object
      created_at:
        type: string
      device_id:
        type: string
      device_name:
        type: string
      device_type:
        type: string
      firmware:
        $ref: '#/definitions/v1.FirmwareInfo'
      id:
        type: integer
      is_activated:
        type: boolean
      is_active:
        type: boolean
      last_seen:
        type: string
      location:
        $ref: '#/definitions/v1.DeviceLocation'
      metadata:
        additionalProperties: true
        type: object
      model:
        type: string
      status:
        description: online, offline, error, unknown
        type: string
      updated_at:
        type: string
      version:
        type: string
    type: object
  v1.DeviceListResponse:
    properties:
      devices:
        items:
          $ref: '#/definitions/v1.DeviceInfo'
        type: array
      pagination:
        $ref: '#/definitions/v1.Pagination'
    type: object
  v1.DeviceLocation:
    properties:
      address:
        type: string
      altitude:
        type: number
      city:
        type: string
      country:
        type: string
      latitude:
        type: number
      longitude:
        type: number
      province:
        type: string
    type: object
  v1.DeviceRegistrationRequest:
    properties:
      device_id:
        type: string
      device_name:
        type: string
      device_type:
        type: string
      location:
        $ref: '#/definitions/v1.DeviceLocation'
      metadata:
        additionalProperties: true
        type: object
      model:
        type: string
      version:
        type: string
    required:
    - device_id
    - device_name
    - device_type
    type: object
  v1.DeviceStatusRequest:
    properties:
      device_id:
        description: 设备MAC地址
        type: string
      is_active:
        description: 激活状态：true激活，false禁用
        type: boolean
    required:
    - device_id
    - is_active
    type: object
  v1.DeviceStatusResponse:
    properties:
      device_info:
        $ref: '#/definitions/v1.DeviceInfo'
      message:
        type: string
      success:
        type: boolean
    type: object
  v1.DeviceUpdateRequest:
    properties:
      configuration:
        additionalProperties: true
        type: object
      device_name:
        type: string
      is_active:
        type: boolean
      location:
        $ref: '#/definitions/v1.DeviceLocation'
      metadata:
        additionalProperties: true
        type: object
    type: object
  v1.FirmwareInfo:
    properties:
      checksum:
        type: string
      description:
        type: string
      download_count:
        type: integer
      release_date:
        type: string
      size:
        type: integer
      url:
        type: string
      version:
        type: string
    type: object
  v1.Pagination:
    properties:
      has_next:
        type: boolean
      has_prev:
        type: boolean
      limit:
        type: integer
      page:
        type: integer
      total:
        type: integer
      total_pages:
        type: integer
    type: object
  v1.PluginControlRequest:
    properties:
      action:
        enum:
        - start
        - stop
        - restart
        - reallocate_port
        type: string
      config:
        additionalProperties: true
        type: object
    required:
    - action
    type: object
  v1.PluginControlResponse:
    properties:
      message:
        type: string
      new_port:
        type: integer
      new_status:
        type: string
      old_port:
        type: integer
      old_status:
        type: string
      process_time:
        type: string
      success:
        type: boolean
    type: object
  v1.PluginListResponse:
    properties:
      page:
        type: integer
      page_size:
        type: integer
      plugins:
        items:
          $ref: '#/definitions/v1.PluginStatus'
        type: array
      total:
        type: integer
      total_pages:
        type: integer
    type: object
  v1.PluginStats:
    properties:
      by_capability:
        additionalProperties:
          type: integer
        type: object
      by_type:
        additionalProperties:
          type: integer
        type: object
      disabled:
        type: integer
      enabled:
        type: integer
      error:
        type: integer
      healthy:
        type: integer
      last_updated:
        type: string
      running:
        type: integer
      stopped:
        type: integer
      total:
        type: integer
      unknown:
        type: integer
    type: object
  v1.PluginStatus:
    properties:
      address:
        type: string
      capabilities:
        items:
          $ref: '#/definitions/v1.CapabilityDef'
        type: array
      created_at:
        type: string
      description:
        type: string
      health_status:
        type: string
      id:
        type: string
      last_health_check:
        type: string
      name:
        type: string
      port:
        type: integer
      status:
        type: string
      type:
        type: string
      updated_at:
        type: string
      version:
        type: string
    type: object
  v1.PortStats:
    properties:
      allocated_ports:
        type: integer
      available_ports:
        type: integer
      reserved_ports:
        type: integer
      total_ports:
        type: integer
      usage_percent:
        type: number
    type: object
  vision.VisionAnalysisData:
    properties:
      error:
        description: 错误信息（失败时）
        type: string
      result:
        description: 分析结果（成功时）
        type: string
    type: object
host: localhost:8080
info:
  contact: {}
  description: 小智服务端，包含OTA与Vision等接口
  title: 小智服务端 API 文档
  version: "1.0"
paths:
  /ota/:
    post:
      consumes:
      - application/json
      description: 处理设备OTA请求，包括设备注册、激活码生成和固件信息返回
      parameters:
      - description: 设备ID
        in: header
        name: device-id
        required: true
        type: string
      - description: 客户端ID
        in: header
        name: client-id
        required: true
        type: string
      - description: 设备信息
        in: body
        name: body
        required: true
        schema:
          additionalProperties: true
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/ota.OTAResponse'
        "400":
          description: Bad Request
          schema:
            type: object
        "500":
          description: Internal Server Error
          schema:
            type: object
      summary: OTA设备注册和固件更新
      tags:
      - OTA
  /v1/devices:
    get:
      description: 获取设备列表，支持分页和过滤
      parameters:
      - description: 按状态过滤
        in: query
        name: status
        type: string
      - description: 按设备类型过滤
        in: query
        name: device_type
        type: string
      - description: 搜索关键词
        in: query
        name: search
        type: string
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 20
        description: 每页数量
        in: query
        name: limit
        type: integer
      - default: created_at
        description: 排序字段
        in: query
        name: sort_by
        type: string
      - default: desc
        description: 排序方向
        in: query
        name: sort_order
        type: string
      - description: 是否返回位置信息
        in: query
        name: location
        type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/httptransport.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.DeviceListResponse'
              type: object
      summary: 获取设备列表
      tags:
      - Devices
    post:
      consumes:
      - application/json
      description: 新设备注册到系统
      parameters:
      - description: 设备注册信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/v1.DeviceRegistrationRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            allOf:
            - $ref: '#/definitions/httptransport.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.DeviceInfo'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
      summary: 设备注册
      tags:
      - Devices
  /v1/devices/{id}:
    delete:
      description: 从系统中删除指定设备
      parameters:
      - description: 设备ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
      summary: 删除设备
      tags:
      - Devices
    get:
      description: 根据ID获取设备的详细信息
      parameters:
      - description: 设备ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/httptransport.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.DeviceInfo'
              type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
      summary: 获取设备详情
      tags:
      - Devices
    put:
      consumes:
      - application/json
      description: 更新指定设备的信息
      parameters:
      - description: 设备ID
        in: path
        name: id
        required: true
        type: string
      - description: 设备更新信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/v1.DeviceUpdateRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/httptransport.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.DeviceInfo'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
      summary: 更新设备信息
      tags:
      - Devices
  /v1/devices/{id}/activate:
    post:
      consumes:
      - application/json
      description: 激活已注册的设备
      parameters:
      - description: 设备ID
        in: path
        name: id
        required: true
        type: string
      - description: 设备激活信息
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/v1.DeviceActivationRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/httptransport.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.DeviceActivationResponse'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
      summary: 激活设备
      tags:
      - Devices
  /v1/devices/status:
    post:
      consumes:
      - application/json
      description: 管理员快速激活或禁用设备，通过设备MAC地址和激活状态
      parameters:
      - description: 设备状态管理请求
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/v1.DeviceStatusRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/httptransport.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.DeviceStatusResponse'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/httptransport.APIResponse'
      summary: 管理员激活/禁用设备
      tags:
      - Devices
  /v1/plugins:
    get:
      description: 获取所有插件的信息，支持分页、筛选和排序
      parameters:
      - description: 插件类型
        enum:
        - LLM
        - TTS
        - ASR
        - Tool
        in: query
        name: type
        type: string
      - description: 插件状态
        enum:
        - installed
        - enabled
        - disabled
        - running
        - stopped
        - error
        in: query
        name: status
        type: string
      - description: 健康状态
        enum:
        - healthy
        - unhealthy
        - unknown
        in: query
        name: health_status
        type: string
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 20
        description: 每页大小
        in: query
        name: page_size
        type: integer
      - default: updated_at
        description: 排序字段
        in: query
        name: sort_by
        type: string
      - default: desc
        description: 排序方向
        enum:
        - asc
        - desc
        in: query
        name: sort_order
        type: string
      - description: 搜索关键词
        in: query
        name: search
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/v1.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.PluginListResponse'
              type: object
      summary: 获取插件列表
      tags:
      - plugins
  /v1/plugins/{id}:
    get:
      description: 根据插件ID获取详细信息
      parameters:
      - description: 插件ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/v1.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.PluginStatus'
              type: object
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/v1.APIResponse'
      summary: 获取插件详情
      tags:
      - plugins
  /v1/plugins/{id}/control:
    post:
      description: 对插件进行启动、停止、重启、重新分配端口等操作
      parameters:
      - description: 插件ID
        in: path
        name: id
        required: true
        type: string
      - description: 控制请求
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/v1.PluginControlRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/v1.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.PluginControlResponse'
              type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/v1.APIResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/v1.APIResponse'
      summary: 控制插件
      tags:
      - plugins
  /v1/plugins/{id}/health:
    post:
      description: 手动触发插件健康检查
      parameters:
      - description: 插件ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/v1.APIResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/v1.APIResponse'
      summary: 检查插件健康状态
      tags:
      - plugins
  /v1/plugins/{id}/reallocate-port:
    post:
      description: 为插件分配新的端口
      parameters:
      - description: 插件ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/v1.APIResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/v1.APIResponse'
      summary: 重新分配插件端口
      tags:
      - plugins
  /v1/plugins/capabilities:
    get:
      description: 获取所有插件的能力定义
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/v1.APIResponse'
      summary: 获取所有插件能力
      tags:
      - plugins
  /v1/plugins/capabilities/{type}:
    get:
      description: 根据类型筛选插件能力
      parameters:
      - description: 能力类型
        in: path
        name: type
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/v1.APIResponse'
      summary: 按类型获取插件能力
      tags:
      - plugins
  /v1/plugins/ports:
    get:
      description: 获取端口使用情况统计
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/v1.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.PortStats'
              type: object
      summary: 获取端口统计信息
      tags:
      - plugins
  /v1/plugins/stats:
    get:
      description: 获取插件的数量、状态分布、健康状态等统计信息
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/v1.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/v1.PluginStats'
              type: object
      summary: 获取插件统计信息
      tags:
      - plugins
  /vision:
    get:
      description: 获取Vision服务的运行状态和可用模型信息
      produces:
      - text/plain
      responses:
        "200":
          description: 服务状态信息
          schema:
            type: string
      summary: 检查Vision服务状态
      tags:
      - Vision
    post:
      consumes:
      - multipart/form-data
      description: 上传图片并进行视觉分析，支持问题询问
      parameters:
      - description: Bearer token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 设备ID
        in: header
        name: Device-Id
        required: true
        type: string
      - description: 客户端ID
        in: header
        name: Client-Id
        required: true
        type: string
      - description: 图片文件
        in: formData
        name: file
        required: true
        type: file
      - description: 分析问题
        in: formData
        name: question
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/vision.VisionAnalysisData'
        "400":
          description: Bad Request
          schema:
            type: object
        "401":
          description: Unauthorized
          schema:
            type: object
        "500":
          description: Internal Server Error
          schema:
            type: object
      summary: 图片视觉分析
      tags:
      - Vision
securityDefinitions:
  BearerAuth:
    description: '请在请求头中添加 Bearer Token，格式为 "Authorization: Bearer <token>"'
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
