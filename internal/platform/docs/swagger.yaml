basePath: /api
definitions:
  ota.Activation:
    properties:
      challenge:
        description: 用于设备认证挑战
        type: string
      code:
        example: "543091"
        type: string
      message:
        example: Anime AI Chat 543091
        type: string
    type: object
  ota.FirmwareInfo:
    properties:
      url:
        example: /ota_bin/1.2.4.bin
        type: string
      version:
        example: 1.2.4
        type: string
    type: object
  ota.MQTTInfo:
    properties:
      client_id:
        example: CGID_test@@@mac@@@client
        type: string
      endpoint:
        example: mqtt://broker:1883
        type: string
      password:
        example: randomPwd
        type: string
      publish_topic:
        example: device-server
        type: string
      subscribe_topic:
        example: "null"
        type: string
      username:
        example: base64string
        type: string
    type: object
  ota.OTAResponse:
    properties:
      activation:
        $ref: '#/definitions/ota.Activation'
      firmware:
        $ref: '#/definitions/ota.FirmwareInfo'
      mqtt:
        $ref: '#/definitions/ota.MQTTInfo'
      server_time:
        $ref: '#/definitions/ota.ServerTimeInfo'
      websocket:
        $ref: '#/definitions/ota.WebSocketInfo'
    type: object
  ota.ServerTimeInfo:
    properties:
      timestamp:
        example: 1720065289451
        type: integer
      timezone_offset:
        example: 480
        type: integer
    type: object
  ota.WebSocketInfo:
    properties:
      url:
        example: wss://your-server/ws
        type: string
    type: object
  vision.VisionAnalysisData:
    properties:
      error:
        description: 错误信息（失败时）
        type: string
      result:
        description: 分析结果（成功时）
        type: string
    type: object
  webapi.APIResponse:
    properties:
      data: {}
      error:
        type: string
      message:
        type: string
      success:
        type: boolean
    type: object
  webapi.AdminConfig:
    properties:
      email:
        type: string
      password:
        type: string
      type:
        description: '"random" 或 "custom"'
        type: string
      username:
        type: string
    type: object
  webapi.AuthResponse:
    properties:
      expires_at:
        type: integer
      token:
        type: string
      user:
        $ref: '#/definitions/webapi.UserInfo'
    type: object
  webapi.ColumnInfo:
    properties:
      defaultValue:
        type: string
      description:
        type: string
      name:
        type: string
      nullable:
        type: boolean
      primaryKey:
        type: boolean
      type:
        type: string
      unique:
        type: boolean
    type: object
  webapi.ConfigRecord:
    properties:
      category:
        type: string
      created_at:
        type: string
      description:
        type: string
      id:
        type: integer
      is_active:
        type: boolean
      key:
        type: string
      updated_at:
        type: string
      value: {}
      version:
        type: integer
    type: object
  webapi.ConfigRecordResponse:
    properties:
      pagination:
        $ref: '#/definitions/webapi.Pagination'
      records:
        items:
          $ref: '#/definitions/webapi.ConfigRecord'
        type: array
    type: object
  webapi.ConnectionTestResult:
    properties:
      latency:
        type: integer
      message:
        type: string
      services:
        additionalProperties:
          type: boolean
        type: object
      success:
        type: boolean
      version:
        type: string
    type: object
  webapi.CreateConfigRecordRequest:
    properties:
      category:
        type: string
      description:
        type: string
      is_active:
        type: boolean
      key:
        type: string
      value: {}
    required:
    - key
    - value
    type: object
  webapi.DatabaseConfig:
    properties:
      database:
        type: string
      host:
        type: string
      password:
        type: string
      path:
        description: SQLite数据库文件路径
        type: string
      port:
        type: integer
      type:
        type: string
      username:
        type: string
    type: object
  webapi.DatabaseSchema:
    properties:
      name:
        type: string
      relationships:
        items:
          $ref: '#/definitions/webapi.ForeignKeyInfo'
        type: array
      tables:
        items:
          $ref: '#/definitions/webapi.TableInfo'
        type: array
      totalRows:
        type: integer
      totalTables:
        type: integer
      type:
        type: string
    type: object
  webapi.DatabaseTestStepRequest:
    properties:
      config:
        $ref: '#/definitions/webapi.DatabaseConfig'
      step:
        type: integer
    type: object
  webapi.ForeignKeyInfo:
    properties:
      name:
        type: string
      onDelete:
        type: string
      onUpdate:
        type: string
      sourceColumn:
        type: string
      sourceTable:
        type: string
      targetColumn:
        type: string
      targetTable:
        type: string
    type: object
  webapi.IndexInfo:
    properties:
      columns:
        items:
          type: string
        type: array
      name:
        type: string
      type:
        type: string
      unique:
        type: boolean
    type: object
  webapi.InitRequest:
    properties:
      adminConfig:
        $ref: '#/definitions/webapi.AdminConfig'
      databaseConfig:
        $ref: '#/definitions/webapi.DatabaseConfig'
      providers:
        additionalProperties: true
        type: object
      systemConfig: {}
    type: object
  webapi.LoginRequest:
    properties:
      password:
        type: string
      username:
        type: string
    required:
    - password
    - username
    type: object
  webapi.Pagination:
    properties:
      limit:
        type: integer
      page:
        type: integer
      pages:
        type: integer
      total:
        type: integer
    type: object
  webapi.RegisterRequest:
    properties:
      email:
        type: string
      password:
        minLength: 6
        type: string
      username:
        type: string
    required:
    - email
    - password
    - username
    type: object
  webapi.SystemConfig:
    properties:
      prompt:
        type: string
      selectedASR:
        type: string
      selectedLLM:
        type: string
      selectedTTS:
        type: string
      selectedVLLLM:
        type: string
    type: object
  webapi.TableInfo:
    properties:
      columns:
        items:
          $ref: '#/definitions/webapi.ColumnInfo'
        type: array
      createdAt:
        type: string
      indexes:
        items:
          $ref: '#/definitions/webapi.IndexInfo'
        type: array
      name:
        type: string
      rowCount:
        type: integer
      size:
        type: integer
      type:
        type: string
    type: object
  webapi.UpdateConfigRecordRequest:
    properties:
      category:
        type: string
      description:
        type: string
      is_active:
        type: boolean
      value: {}
    type: object
  webapi.UserInfo:
    properties:
      email:
        type: string
      id:
        type: integer
      nickname:
        type: string
      role:
        type: string
      username:
        type: string
    type: object
host: localhost:8080
info:
  contact: {}
  description: 小智服务端，包含OTA与Vision等接口
  title: 小智服务端 API 文档
  version: "1.0"
paths:
  /admin/config/records:
    get:
      description: 获取所有配置记录，支持分页和过滤
      parameters:
      - description: 按分类过滤
        in: query
        name: category
        type: string
      - description: 按活跃状态过滤
        in: query
        name: active
        type: boolean
      - default: 1
        description: 页码
        in: query
        name: page
        type: integer
      - default: 20
        description: 每页数量
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/webapi.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/webapi.ConfigRecordResponse'
              type: object
        "401":
          description: Unauthorized
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: 获取配置记录列表
      tags:
      - Admin
    post:
      consumes:
      - application/json
      description: 创建新的配置记录
      parameters:
      - description: 配置记录数据
        in: body
        name: record
        required: true
        schema:
          $ref: '#/definitions/webapi.CreateConfigRecordRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            allOf:
            - $ref: '#/definitions/webapi.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/webapi.ConfigRecord'
              type: object
        "400":
          description: Bad Request
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: 创建配置记录
      tags:
      - Admin
  /admin/config/records/{id}:
    delete:
      description: 根据ID删除配置记录
      parameters:
      - description: 配置记录ID
        in: path
        name: id
        required: true
        type: integer
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.APIResponse'
        "404":
          description: Not Found
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: 删除配置记录
      tags:
      - Admin
    get:
      description: 根据ID获取配置记录详情
      parameters:
      - description: 配置记录ID
        in: path
        name: id
        required: true
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/webapi.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/webapi.ConfigRecord'
              type: object
        "404":
          description: Not Found
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: 获取单个配置记录
      tags:
      - Admin
    put:
      consumes:
      - application/json
      description: 根据ID更新配置记录
      parameters:
      - description: 配置记录ID
        in: path
        name: id
        required: true
        type: integer
      - description: 配置记录更新数据
        in: body
        name: record
        required: true
        schema:
          $ref: '#/definitions/webapi.UpdateConfigRecordRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            allOf:
            - $ref: '#/definitions/webapi.APIResponse'
            - properties:
                data:
                  $ref: '#/definitions/webapi.ConfigRecord'
              type: object
        "400":
          description: Bad Request
          schema:
            type: object
        "404":
          description: Not Found
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: 更新配置记录
      tags:
      - Admin
  /admin/database/schema:
    get:
      description: 获取数据库的完整模式信息，包括表、列、索引等
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.DatabaseSchema'
        "500":
          description: Internal Server Error
          schema:
            type: object
      summary: 获取数据库模式
      tags:
      - Admin
  /admin/database/tables:
    get:
      description: 获取数据库中所有表的基本信息
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
        "500":
          description: Internal Server Error
          schema:
            type: object
      summary: 获取数据库表列表
      tags:
      - Admin
  /admin/system:
    get:
      description: 获取服务器的系统配置信息，包括选择的提供商和默认提示词
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.SystemConfig'
        "401":
          description: Unauthorized
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: 获取系统配置
      tags:
      - Admin
  /admin/system/database-config:
    get:
      description: 获取当前保存的数据库配置（不包含密码）
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
      summary: 获取数据库配置
      tags:
      - Admin
  /admin/system/init:
    post:
      consumes:
      - application/json
      description: 初始化Xiaozhi-Flow系统，创建数据库和管理员用户
      parameters:
      - description: 初始化配置
        in: body
        name: config
        required: true
        schema:
          $ref: '#/definitions/webapi.InitRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
        "400":
          description: Bad Request
          schema:
            type: object
      summary: 系统初始化
      tags:
      - Admin
  /admin/system/save-database-config:
    post:
      consumes:
      - application/json
      description: 保存数据库配置到配置文件
      parameters:
      - description: 数据库配置
        in: body
        name: config
        required: true
        schema:
          $ref: '#/definitions/webapi.DatabaseConfig'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
        "400":
          description: Bad Request
          schema:
            type: object
      summary: 保存数据库配置
      tags:
      - Admin
  /admin/system/status:
    get:
      description: 获取当前系统的运行状态和服务信息
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
      summary: 获取系统状态
      tags:
      - Admin
  /admin/system/test-connection:
    post:
      consumes:
      - application/json
      description: 测试与指定数据库的连接状态和延迟
      parameters:
      - description: 数据库配置
        in: body
        name: config
        required: true
        schema:
          $ref: '#/definitions/webapi.DatabaseConfig'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.ConnectionTestResult'
        "400":
          description: Bad Request
          schema:
            type: object
      summary: 测试数据库连接
      tags:
      - Admin
  /admin/system/test-database-step:
    post:
      consumes:
      - application/json
      description: 分步骤测试数据库配置和连接
      parameters:
      - description: 步骤信息
        in: body
        name: step
        required: true
        schema:
          $ref: '#/definitions/webapi.DatabaseTestStepRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
        "400":
          description: Bad Request
          schema:
            type: object
      summary: 测试数据库配置步骤
      tags:
      - Admin
  /auth/login:
    post:
      consumes:
      - application/json
      description: Authenticate user with username and password
      parameters:
      - description: Login credentials
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/webapi.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.AuthResponse'
        "400":
          description: Bad Request
          schema:
            type: object
        "401":
          description: Unauthorized
          schema:
            type: object
      summary: User login
      tags:
      - Auth
  /auth/logout:
    delete:
      description: Logout the current user and invalidate the session
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: User logout
      tags:
      - Auth
  /auth/logout-all:
    delete:
      description: Logout the user from all active sessions
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: Logout from all devices
      tags:
      - Auth
  /auth/me:
    get:
      description: Get information about the currently authenticated user
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.UserInfo'
        "401":
          description: Unauthorized
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: Get current user
      tags:
      - Auth
  /auth/refresh:
    post:
      description: Refresh the authentication token
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.AuthResponse'
        "401":
          description: Unauthorized
          schema:
            type: object
      security:
      - BearerAuth: []
      summary: Refresh token
      tags:
      - Auth
  /auth/register:
    post:
      consumes:
      - application/json
      description: Register a new user account
      parameters:
      - description: Registration information
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/webapi.RegisterRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/webapi.AuthResponse'
        "400":
          description: Bad Request
          schema:
            type: object
        "409":
          description: Conflict
          schema:
            type: object
      summary: User registration
      tags:
      - Auth
  /cfg:
    get:
      description: 检查配置服务的运行状态
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            type: object
      summary: 检查配置服务状态
      tags:
      - Config
  /ota/:
    post:
      consumes:
      - application/json
      description: 处理设备OTA请求，包括设备注册、激活码生成和固件信息返回
      parameters:
      - description: 设备ID
        in: header
        name: device-id
        required: true
        type: string
      - description: 客户端ID
        in: header
        name: client-id
        required: true
        type: string
      - description: 设备信息
        in: body
        name: body
        required: true
        schema:
          additionalProperties: true
          type: object
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/ota.OTAResponse'
        "400":
          description: Bad Request
          schema:
            type: object
        "500":
          description: Internal Server Error
          schema:
            type: object
      summary: OTA设备注册和固件更新
      tags:
      - OTA
  /vision:
    get:
      description: 获取Vision服务的运行状态和可用模型信息
      produces:
      - text/plain
      responses:
        "200":
          description: 服务状态信息
          schema:
            type: string
      summary: 检查Vision服务状态
      tags:
      - Vision
    post:
      consumes:
      - multipart/form-data
      description: 上传图片并进行视觉分析，支持问题询问
      parameters:
      - description: Bearer token
        in: header
        name: Authorization
        required: true
        type: string
      - description: 设备ID
        in: header
        name: Device-Id
        required: true
        type: string
      - description: 客户端ID
        in: header
        name: Client-Id
        required: true
        type: string
      - description: 图片文件
        in: formData
        name: file
        required: true
        type: file
      - description: 分析问题
        in: formData
        name: question
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/vision.VisionAnalysisData'
        "400":
          description: Bad Request
          schema:
            type: object
        "401":
          description: Unauthorized
          schema:
            type: object
        "500":
          description: Internal Server Error
          schema:
            type: object
      summary: 图片视觉分析
      tags:
      - Vision
swagger: "2.0"
